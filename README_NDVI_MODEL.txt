# Инструкция по использованию NDVI-модели

## 1. Подготовка данных

### Конфигурационный файл
Все параметры для обучения и тестирования задаются в файле `configs/config_ndvi.json`. Пример структуры:

```
{
    "coordinates": [
        [широта1, долгота1],
        [широта2, долгота2],
        ... (замкнутый полигон)
    ],
    "start_date": "YYYY-MM-DD",  # начальная дата анализа
    "end_date": "YYYY-MM-DD",    # конечная дата анализа
    "n_steps_in": 21,             # длина входной последовательности для LSTM
    "n_steps_out": 7,             # длина прогноза
    "percentile": 40,             # перцентиль для фильтрации выбросов NDVI
    "bimonthly_period": "1M",    # период для фильтрации (например, "1M" или "2M")
    "spline_smoothing": 0.7       # степень сглаживания NDVI
}
```

- **coordinates** — список точек полигона (широта, долгота), минимум 3, первая и последняя совпадают.
- **start_date**, **end_date** — диапазон анализа (формат YYYY-MM-DD).
- Остальные параметры — гиперпараметры модели и фильтрации.

### Данные
- NDVI и погодные данные скачиваются автоматически через Google Earth Engine и open-meteo.com по координатам и датам из конфига.
- Никаких дополнительных файлов с данными готовить не нужно.

## 2. Обучение модели

1. Убедитесь, что все зависимости установлены (см. `requirements.txt`).
2. Запустите основной файл для обучения:
   ```
   python ndvi_ts_lstm.py
   ```
3. После завершения обучения веса моделей сохранятся в папку `weights/`:
   - `weights/model_weights_original.pth`
   - `weights/model_weights_filtered.pth`

## 3. Тестирование и предсказания

1. Запустите файл для тестирования и инференса:
   ```
   python test_models.py
   ```
2. Скрипт автоматически:
   - загрузит веса моделей
   - скачает NDVI и погодные данные по конфига
   - выполнит предсказания на тестовом и будущем периоде
   - выведет метрики качества (MAE, RMSE, R2) и примеры предсказаний

## 4. Использование модели для новых данных

- Измените координаты и/или даты в `configs/config_ndvi.json`.
- Повторите шаги обучения и тестирования.
- Если хотите только предсказания для новых данных — просто запустите `test_models.py` (при наличии весов).

## 5. Важные замечания

- Для работы с NDVI требуется доступ к Google Earth Engine (GEE) и наличие service account ключа (`key.json`).
- Для работы с погодой используется open-meteo.com (интернет обязателен).
- Все результаты и графики сохраняются в папку `images/` (если используется визуализация).
- Для корректной работы рекомендуется использовать Python 3.9–3.12 и все зависимости из `requirements.txt`.

## 6. Пример запуска (Linux)

```bash
python ndvi_ts_lstm.py   # обучение и сохранение весов
python test_models.py    # тестирование и предсказания
```

---

Если возникли вопросы по формату данных, настройке или запуску — обращайтесь к разработчику или смотрите комментарии в исходных файлах. 